export TERM=xterm-256color

export HISTFILE="/storage/.bash_history"
export HISTSIZE=100000 SAVEHIST=100000
# avoid duplicates..
HISTCONTROL='ignoreboth:erasedups'
# append history entries..
shopt -s histappend

# After each command, save and reload history
export PROMPT_COMMAND="history -a; history -c; history -r; $PROMPT_COMMAND"

if [ -f /etc/bash_completion.d/git-prompt ];
then
    source /etc/bash_completion.d/git-prompt
fi

COLOR_GIT_CLEAN='\[\033[1;32m\]'
COLOR_GIT_MODIFIED='\[\033[0;33m\]'
COLOR_GIT_STAGED='\[\033[0;36m\]'
COLOR_RESET='\[\033[0m\]'

function git_prompt() {
  if [ -e ".git" ]; then
    branch_name=$(git symbolic-ref -q HEAD)
    branch_name=${branch_name##refs/heads/}
    branch_name=${branch_name:-HEAD}

    echo -n "â†’ "

    if [[ $(git status 2> /dev/null | tail -n1) = *"nothing to commit"* ]]; then
      echo -n "$COLOR_GIT_CLEAN$branch_name$COLOR_RESET"
    elif [[ $(git status 2> /dev/null | head -n5) = *"Changes to be committed"* ]]; then
      echo -n "$COLOR_GIT_STAGED$branch_name$COLOR_RESET"
    else
      echo -n "$COLOR_GIT_MODIFIED$branch_name*$COLOR_RESET"
    fi

    echo -n " "
  fi
}

function prompt() {
  PS1="[ \[\033[0;34m\]\w\[\033[0;37m\] $(git_prompt)\[\033[0;37m\]] \$ "
}

PROMPT_COMMAND=prompt

alias ls='ls --color=auto'

if [ -S /opt/emacsd/server/emacsd ]; then
  cd /storage/
  emacsclient -s /opt/emacsd/server/emacsd --tty
fi