#!/usr/bin/env bash

export EMACS_SERVER_SOCKET=${TMPDIR:-/tmp}/emacs$(id -u)/emacsd

cd /var/emacsd

case $1 in
    start)
        /usr/bin/emacs -q --daemon=$EMACS_SERVER_SOCKET -l init.el
        ;;
    stop)
        /usr/bin/emacsclient -s $EMACS_SERVER_SOCKET --eval "(let (kill-emacs-hook) (kill-emacs))"
        ;;
    start-web)
        /usr/bin/nohup /usr/local/bin/wetty --conf ./wetty.conf > /dev/null 2>&1 & echo $! > wetty.pid
        ;;
    stop-web)
        kill `cat wetty.pid`
        ;;
    *)
        /usr/bin/emacsclient -s $EMACS_SERVER_SOCKET -c
        ;;
esac
